<!-- Overlay backdrop -->
@if (isOpen()) {
  <div class="panel-overlay" (click)="onClose()"></div>
}

<!-- Slide-out panel -->
<div class="work-order-panel" [class.work-order-panel--open]="isOpen()">
  <!-- Header -->
  <div class="work-order-panel__header">
    <h2 class="work-order-panel__title">{{ panelTitle() }}</h2>
    <button class="work-order-panel__close" (click)="onClose()" type="button" aria-label="Close">
      &times;
    </button>
  </div>

  <!-- Form content -->
  <div class="work-order-panel__content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Work Order Name -->
      <div class="form-field">
        <label class="form-field__label" for="name">Work Order Name</label>
        <input
          id="name"
          type="text"
          class="form-field__input"
          [class.form-field__input--error]="
            hasError('name', 'required') || hasError('name', 'minlength')
          "
          formControlName="name"
          placeholder="Enter work order name"
        />
        @if (getErrorMessage('name')) {
          <span class="form-field__error">{{ getErrorMessage('name') }}</span>
        }
      </div>

      <!-- Status Dropdown -->
      <div class="form-field">
        <label class="form-field__label" for="status">Status</label>
        <ng-select
          [items]="statusOptions"
          bindLabel="label"
          bindValue="value"
          formControlName="status"
          placeholder="Select status"
          [clearable]="false"
          class="custom-ng-select"
        >
          <ng-template ng-label-tmp let-item="item">
            <span class="status-option">
              <span class="status-option__dot" [style.background-color]="item.color"></span>
              {{ item.label }}
            </span>
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            <span class="status-option">
              <span class="status-option__dot" [style.background-color]="item.color"></span>
              {{ item.label }}
            </span>
          </ng-template>
        </ng-select>
        @if (getErrorMessage('status')) {
          <span class="form-field__error">{{ getErrorMessage('status') }}</span>
        }
      </div>

      <!-- Work Center Dropdown -->
      <div class="form-field">
        <label class="form-field__label" for="workCenter">Work Center</label>
        <ng-select
          [items]="workCenters()"
          bindLabel="data.name"
          bindValue="docId"
          formControlName="workCenterId"
          placeholder="Select work center"
          [clearable]="false"
          class="custom-ng-select"
        >
        </ng-select>
        @if (getErrorMessage('workCenterId')) {
          <span class="form-field__error">{{ getErrorMessage('workCenterId') }}</span>
        }
      </div>

      <!-- Start Date -->
      <div class="form-field">
        <label class="form-field__label" for="startDate">Start Date</label>
        <div class="datepicker-wrapper">
          <input
            id="startDate"
            type="text"
            class="form-field__input"
            [class.form-field__input--error]="hasError('startDate', 'required')"
            formControlName="startDate"
            placeholder="yyyy-mm-dd"
            ngbDatepicker
            #startDatePicker="ngbDatepicker"
            (click)="startDatePicker.toggle()"
            readonly
          />
        </div>
        @if (getErrorMessage('startDate')) {
          <span class="form-field__error">{{ getErrorMessage('startDate') }}</span>
        }
      </div>

      <!-- End Date -->
      <div class="form-field">
        <label class="form-field__label" for="endDate">End Date</label>
        <div class="datepicker-wrapper">
          <input
            id="endDate"
            type="text"
            class="form-field__input"
            [class.form-field__input--error]="hasError('endDate', 'required')"
            formControlName="endDate"
            placeholder="yyyy-mm-dd"
            ngbDatepicker
            #endDatePicker="ngbDatepicker"
            (click)="endDatePicker.toggle()"
            readonly
          />
        </div>
        @if (getErrorMessage('endDate')) {
          <span class="form-field__error">{{ getErrorMessage('endDate') }}</span>
        }
      </div>

      <!-- Overlap Error -->
      @if (overlapError()) {
        <div class="form-field">
          <div class="alert alert--error">{{ overlapError() }}</div>
        </div>
      }
    </form>
  </div>

  <!-- Footer -->
  <div class="work-order-panel__footer">
    <div class="work-order-panel__actions">
      @if (mode() === 'edit') {
        <button class="btn btn--danger" (click)="onDelete()" type="button">Delete</button>
      }
      <button class="btn btn--secondary" (click)="onClose()" type="button">Cancel</button>
      <button
        class="btn btn--primary"
        (click)="onSubmit()"
        type="button"
        [disabled]="isSubmitting()"
      >
        {{ isSubmitting() ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>
</div>
