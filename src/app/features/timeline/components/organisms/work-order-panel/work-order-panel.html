<!-- Overlay backdrop -->
<div class="panel-overlay" [class.panel-overlay--visible]="isOpen()" (click)="onClose()"></div>

<!-- Slide-out panel -->
<div class="work-order-panel" [class.work-order-panel--open]="isOpen()">
  <!-- Header -->
  <div class="work-order-panel__header">
    <div class="work-order-panel__header-content">
      <h2 class="work-order-panel__title">{{ panelTitle() }}</h2>
      <p class="work-order-panel__subtitle">Specify the dates, name and status for this order</p>
    </div>
    <div class="work-order-panel__actions">
      @if (mode() === 'edit') {
        <app-button
          variant="danger"
          type="button"
          (clicked)="onDelete()"
          class="work-order-panel__delete-button"
        >
          Delete
        </app-button>
      }
      <app-button variant="secondary" type="button" (clicked)="onClose()">Cancel</app-button>
      <app-button
        variant="primary"
        type="button"
        [disabled]="isSubmitting()"
        [loading]="isSubmitting()"
        (clicked)="onSubmit()"
      >
        {{ isSubmitting() ? 'Saving...' : 'Create' }}
      </app-button>
    </div>
  </div>

  <!-- Form content -->
  <div class="work-order-panel__content">
    <form class="work-order-panel__form" [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Work Order Name -->
      <app-input
        id="name"
        label="Work Order Name"
        type="text"
        placeholder="Enter work order name"
        formControlName="name"
        [errorMessage]="getErrorMessage('name')"
      />

      <!-- Status Dropdown -->
      <ng-template #statusLabelTemplate let-item>
        <span
          class="status-option__chip"
          [style.background-color]="getStatusBgColor(item.value)"
          [style.color]="getStatusTextColor(item.value)"
          [style.border-color]="getStatusBorderColor(item.value)"
        >
          {{ item.label }}
        </span>
      </ng-template>
      <ng-template #statusOptionTemplate let-item>
        {{ item.label }}
      </ng-template>
      <app-dropdown
        id="status"
        label="Status"
        [items]="statusOptions"
        bindLabel="label"
        bindValue="value"
        placeholder="Select status"
        [clearable]="false"
        formControlName="status"
        [labelTemplate]="statusLabelTemplate"
        [optionTemplate]="statusOptionTemplate"
        [errorMessage]="getErrorMessage('status')"
      />

      <!-- Work Center Dropdown -->
      <app-dropdown
        id="workCenter"
        label="Work Center"
        [items]="workCenters()"
        bindLabel="data.name"
        bindValue="docId"
        placeholder="Select work center"
        [clearable]="false"
        formControlName="workCenterId"
        [errorMessage]="getErrorMessage('workCenterId')"
      />

      <!-- Start Date -->
      <app-date-picker
        id="startDate"
        label="Start Date"
        placeholder="yyyy-mm-dd"
        formControlName="startDate"
        [errorMessage]="getErrorMessage('startDate')"
      />

      <!-- End Date -->
      <app-date-picker
        id="endDate"
        label="End Date"
        placeholder="yyyy-mm-dd"
        formControlName="endDate"
        [errorMessage]="getErrorMessage('endDate')"
      />

      <!-- Overlap Error -->
      @if (overlapError()) {
        <div class="form-field">
          <div class="alert alert--error">{{ overlapError() }}</div>
        </div>
      }
    </form>
  </div>

  <!-- Footer -->
  <div class="work-order-panel__footer"></div>
</div>
